arrows(x, BIC_lower, x, BIC_upper,length=0.05, angle=90, code=3)
abline(v = 46, col = 'blue')
abline(h = min(mean_BIC) + 2, col = "Red")
legend('topright', legend = c('Mean', 'Lowest BIC + 2','Best component'),
pch = c(16, NA, NA), lty = c(NA, 1, 1), col = c('black', 'red', 'blue'))
plsFit.info
?PLS_beta_kfoldcv_formula
?kfolds2CVinfos_beta
plsFit.info
?kfolds2CVinfos_beta[[1]]
plsFit.info[[1]]
plsFit.info[[1]] == plsFit.info[[2]]
#lowest AIC
best_aic = min(mean_aic)
best_aic
plsFit.info[[1]]
for(NK in 1:5){
results.list = list()
for(k in 1:10){
matr = as.matrix(plsFit$results_kfolds[[NK]][[k]][,54])
result.matrix = assign(paste0('matr',k), matr)
results.list <- list.append(results.list, get('result.matrix'))
}
full.mat = Reduce(rbind, results.list)
full.mat = full.mat[row.names(spec_df),,drop = F]
assign(paste0('full.mat_', NK), full.mat)
}
#average the predictions
mean.predictions = as.data.frame((full.mat_1 + full.mat_2 + full.mat_3 +
full.mat_4 + full.mat_5)/5)
#Add pertinent metadata
colnames(mean.predictions) <- c("Predictions")
mean.predictions$DA <- spectra.df$DA
mean.predictions$Species_ID <- spectra.df$Species_ID
mean.predictions$Name <- spectra.df$Name
View(mean.predictions)
?aggregate
med = aggregate(mean.predictions$Predictions, by = Name, median)
med = aggregate(mean.predictions$Predictions, by = mean.predictions$Name, median)
l = list(mean.predictions$Name)
l
med = aggregate(mean.predictions$Predictions, by = l, median)
med
mean_ref = aggregate(mean.predictions$DA, by = l, mean)
plot(mean_ref, med)
plot(mean_ref[,2], med[,2])
View(mean.predictions)
oct = mean.predictions[mean.predictions$Species_ID == 'DO',]
oct1 = oct[oct$Predictions > .9,]
oct1
oct1 = oct[oct$Predictions > .8,]
oct1
max = aggregate(mean.predictions$Predictions, by = l, max)
min = aggregate(mean.predictions$Predictions, by = l, min)
dev.new(width = 6, height = 6, unit = 'in')
par(mfrow = c(1,1))
plot(mean_ref[,2], med[,2], cex.lab = 1.5,
xlab = "Actual Dryas alaskensis ancestry",
ylab = "Predicted Dryas alaskensi ancestry")
lines(x = c(-2, 2), y = c(-2, 2))
arrows(med[,2], min[,2], med[,2], max[,2],length=0.05, angle=90, code=3)
points(mean.predictions$DA, mean.predictions$Predictions,
col = mean.predictions$color, pch = 16)
legend("bottomright", inset = 0.01,
legend=c("D. octopetala", "Hybrid", "D. alaskensis", "1:1 line"),
text.font = c(3,1,3,1),
col=c("#F8766D", "black", "#00B0F6", "black"), pch = c(16,16,16,NA),
lty = c(NA,NA,NA,1), bg = 'white')
View(med)
mean.predictions$color = 'black'
mean.predictions$color[mean.predictions$Species_ID == "DO"] = "#F8766D"
mean.predictions$color[mean.predictions$Species_ID == "DA"] = "#00B0F6"
col = aggregate(mean.predictions$color, by = l, mean)
warnings()
col = aggregate(as.factor(mean.predictions$color), by = l, mean)
warnings()
View(mean_rmse)
View(mean.predictions)
sp = aggregate(mean.predictions$Species_ID, by = l, mean)
sp = aggregate(as.factor(mean.predictions$Species_ID), by = l, mean)
View(sp)
med2 = aggregate(Predictions~Name + color, data = mean.predictions, median)
View(med2)
med = aggregate(Predictions~Name + color, data = mean.predictions, median)
dev.new(width = 6, height = 6, unit = 'in')
par(mfrow = c(1,1))
plot(mean_ref[,2], med[,2], cex.lab = 1.5,
xlab = "Actual Dryas alaskensis ancestry",
ylab = "Predicted Dryas alaskensi ancestry")
lines(x = c(-2, 2), y = c(-2, 2))
arrows(mean_ref[,2], min[,2], mean_ref[,2], max[,2],length=0.05, angle=90, code=3)
points(mean_ref[,2], med$Predictions,
col = med$color, pch = 16)
legend("bottomright", inset = 0.01,
legend=c("D. octopetala", "Hybrid", "D. alaskensis", "1:1 line"),
text.font = c(3,1,3,1),
col=c("#F8766D", "black", "#00B0F6", "black"), pch = c(16,16,16,NA),
lty = c(NA,NA,NA,1), bg = 'white')
par(mfrow = c(1,1))
plot(mean_ref[,2], med[,2], cex.lab = 1.5,
xlab = "Actual Dryas alaskensis ancestry",
ylab = "Predicted Dryas alaskensi ancestry")
lines(x = c(-2, 2), y = c(-2, 2))
arrows(mean_ref[,2], min[,2], mean_ref[,2], max[,2],length=0.05, angle=90, code=3)
points(mean_ref[,2], med$Predictions,
col = med$color, pch = 16)
legend("bottomright", inset = 0.01,
legend=c("D. octopetala", "Hybrid", "D. alaskensis", "1:1 line"),
text.font = c(3,1,3,1),
col=c("#F8766D", "black", "#00B0F6", "black"), pch = c(16,16,16,NA),
lty = c(NA,NA,NA,1), bg = 'white')
View(mean_ref)
med$DA = mean_ref[,2]
med$max = max[,2]
med$max = min[,2]
max = aggregate(mean.predictions$Predictions, by = l, max)
med$max = max[,2]
min = aggregate(mean.predictions$Predictions, by = l, min)
med$min = min[,2]
x = 0:1
dev.new(width = 6, height = 6, unit = 'in')
par(mfrow = c(1,1))
plot(med$DA, med$Predictions, cex.lab = 1.5,
xlab = "Actual Dryas alaskensis ancestry",
ylab = "Predicted Dryas alaskensi ancestry")
lines(x = c(-2, 2), y = c(-2, 2))
arrows(x, med$min, x, med$max,length=0.05, angle=90, code=3)
points(med$DA, med$Predictions,
col = med$color, pch = 16)
legend("bottomright", inset = 0.01,
legend=c("D. octopetala", "Hybrid", "D. alaskensis", "1:1 line"),
text.font = c(3,1,3,1),
col=c("#F8766D", "black", "#00B0F6", "black"), pch = c(16,16,16,NA),
lty = c(NA,NA,NA,1), bg = 'white')
x = 0:1
dev.new(width = 6, height = 6, unit = 'in')
par(mfrow = c(1,1))
plot(med$DA, med$Predictions, cex.lab = 1.5,
xlab = "Actual Dryas alaskensis ancestry",
ylab = "Predicted Dryas alaskensi ancestry")
lines(x = c(-2, 2), y = c(-2, 2))
arrows(x, med$min, x, med$max,length=0.05, angle=90, code=3)
points(med$DA, med$Predictions,
col = med$color, pch = 16)
par(mfrow = c(1,1))
plot(med$DA, med$Predictions, cex.lab = 1.5,
xlab = "Actual Dryas alaskensis ancestry",
ylab = "Predicted Dryas alaskensi ancestry")
lines(x = c(-2, 2), y = c(-2, 2))
arrows(x, med$min, x, med$max,length=0.05, angle=90, code=3)
points(med$DA, med$Predictions,
col = med$color, pch = 16)
plot(med$DA, med$Predictions)
med = aggregate(Predictions, by = Name, data = mean.predictions, median)
View(mean.predictions)
med = aggregate(mean.predictions$Predictions, by = l, median)
View(med)
DA = aggregate(DA~Name + color, data = mean.predictions, mean)
plot(DA$DA, med[,2])
DA = aggregate(DA~Name, data = mean.predictions, mean)
plot(DA$DA, med[,2])
View(DA)
col = aggregate(colors~Name, data = mean.predictions, mean)
View(mean.predictions)
pred = mean.predictions[DA$Name,,drop = T]
View(pred)
sp = aggregate(Species_ID~Name, data = mean.predictions,mean)
sp = aggregate(as.numeric(mean.predictions$Species_ID, by = mean.predictions$Name, mean))
sp = aggregate(as.numeric(mean.predictions$Species_ID), by = mean.predictions$Name, mean))
sp = aggregate(as.numeric(mean.predictions$Species_ID), by = mean.predictions$Name, mean)
sp = aggregate(as.numeric(mean.predictions$Species_ID), by = l, mean)
View(sp)
DA$Predictions = med[,2]
DA$color = 'black'
DA$color[DA$DA > .7] = "#00B0F6"
DA$color[DA$DA < .3] = "#F8766D"
View(DA)
plot(DA$DA, DA$Predictions)
max = aggregate(mean.predictions$Predictions, by = l, max)
DA$max = max[,2]
min = aggregate(mean.predictions$Predictions, by = l, min)
DA$min = min[,2]
View(DA)
plot(DA$DA, DA$Predictions, cex.lab = 1.5,
xlab = "Actual Dryas alaskensis ancestry",
ylab = "Predicted Dryas alaskensi ancestry")
lines(x = c(-2, 2), y = c(-2, 2))
points(DA$DA, DA$Predictions,
col = DA$color, pch = 16)
arrows(DA$DA, DA$min, DA$DA, DA$max,length=0.05, angle=90, code=3)
par(mfrow = c(1,1))
plot(DA$DA, DA$Predictions, cex.lab = 1.5,
xlab = "Actual Dryas alaskensis ancestry",
ylab = "Predicted Dryas alaskensi ancestry")
lines(x = c(-2, 2), y = c(-2, 2))
arrows(DA$DA, DA$min, DA$DA, DA$max,length=0.05, angle=90, code=3)
points(DA$DA, DA$Predictions,
col = DA$color, pch = 16)
legend("bottomright", inset = 0.01,
legend=c("D. octopetala", "Hybrid", "D. alaskensis", "1:1 line"),
text.font = c(3,1,3,1),
col=c("#F8766D", "black", "#00B0F6", "black"), pch = c(16,16,16,NA),
lty = c(NA,NA,NA,1), bg = 'white')
med = aggregate(mean.predictions$Predictions, by = l, mean)
DA$Predictions = med[,2]
par(mfrow = c(1,1))
plot(DA$DA, DA$Predictions, cex.lab = 1.5,
xlab = "Actual Dryas alaskensis ancestry",
ylab = "Predicted Dryas alaskensi ancestry")
lines(x = c(-2, 2), y = c(-2, 2))
arrows(DA$DA, DA$min, DA$DA, DA$max,length=0.05, angle=90, code=3)
points(DA$DA, DA$Predictions,
col = DA$color, pch = 16)
legend("bottomright", inset = 0.01,
legend=c("D. octopetala", "Hybrid", "D. alaskensis", "1:1 line"),
text.font = c(3,1,3,1),
col=c("#F8766D", "black", "#00B0F6", "black"), pch = c(16,16,16,NA),
lty = c(NA,NA,NA,1), bg = 'white')
oct = mean.predictions[mean.predictions$Species_ID == 'DO',]
oct1 = oct[oct$Predictions >.9]
oct1 = oct[oct$Predictions >.9,]
oct1
wdb30 = oct[oct$Name == 'DryoctWDB30',]
wdb30
wdb31 = oct[oct$Name == 'DryoctWDB31']
wdb31 = oct[oct$Name == 'DryoctWDB31',]
wdb31
dev.new(width = 6, height = 6, unit = 'in')
par(mfrow = c(1,1))
plot(DA$DA, DA$Predictions, cex.lab = 1.5,
xlab = "Actual Dryas alaskensis ancestry",
ylab = "Predicted Dryas alaskensi ancestry")
lines(x = c(-2, 2), y = c(-2, 2))
arrows(DA$DA, DA$min, DA$DA, DA$max,length=0.05, angle=90, code=3)
points(DA$DA, DA$Predictions,
col = DA$color, pch = 1)
legend("bottomright", inset = 0.01,
legend=c("D. octopetala", "Hybrid", "D. alaskensis", "1:1 line"),
text.font = c(3,1,3,1),
col=c("#F8766D", "black", "#00B0F6", "black"), pch = c(16,16,16,NA),
lty = c(NA,NA,NA,1), bg = 'white')
par(mfrow = c(1,1))
plot(DA$DA, DA$Predictions, cex.lab = 1.5,
xlab = "Actual Dryas alaskensis ancestry",
ylab = "Predicted Dryas alaskensi ancestry")
lines(x = c(-2, 2), y = c(-2, 2))
arrows(DA$DA, DA$min, DA$DA, DA$max,length=0.05, angle=90, code=3)
points(DA$DA, DA$Predictions,
col = DA$color, pch = 4)
legend("bottomright", inset = 0.01,
legend=c("D. octopetala", "Hybrid", "D. alaskensis", "1:1 line"),
text.font = c(3,1,3,1),
col=c("#F8766D", "black", "#00B0F6", "black"), pch = c(16,16,16,NA),
lty = c(NA,NA,NA,1), bg = 'white')
par(mfrow = c(1,1))
plot(DA$DA, DA$Predictions, cex.lab = 1.5,
xlab = "Actual Dryas alaskensis ancestry",
ylab = "Predicted Dryas alaskensi ancestry")
lines(x = c(-2, 2), y = c(-2, 2))
arrows(DA$DA, DA$min, DA$DA, DA$max,length=0.05, angle=90, code=3)
points(DA$DA, DA$Predictions,
col = DA$color, pch = 4)
legend("bottomright", inset = 0.01,
legend=c("D. octopetala", "Hybrid", "D. alaskensis", "1:1 line"),
text.font = c(3,1,3,1),
col=c("#F8766D", "black", "#00B0F6", "black"), pch = c(16,16,16,NA),
lty = c(NA,NA,NA,1), bg = 'white')
par(mfrow = c(1,1))
plot(DA$DA, DA$Predictions, cex.lab = 1.5,
xlab = "Actual Dryas alaskensis ancestry",
ylab = "Predicted Dryas alaskensi ancestry")
lines(x = c(-2, 2), y = c(-2, 2))
arrows(DA$DA, DA$min, DA$DA, DA$max,length=0.05, angle=90, code=3)
points(DA$DA, DA$Predictions,
col = DA$color, pch = 10)
legend("bottomright", inset = 0.01,
legend=c("D. octopetala", "Hybrid", "D. alaskensis", "1:1 line"),
text.font = c(3,1,3,1),
col=c("#F8766D", "black", "#00B0F6", "black"), pch = c(16,16,16,NA),
lty = c(NA,NA,NA,1), bg = 'white')
par(mfrow = c(1,1))
plot(DA$DA, DA$Predictions, cex.lab = 1.5,
xlab = "Actual Dryas alaskensis ancestry",
ylab = "Predicted Dryas alaskensi ancestry")
lines(x = c(-2, 2), y = c(-2, 2))
arrows(DA$DA, DA$min, DA$DA, DA$max,length=0.05, angle=90, code=3)
points(DA$DA, DA$Predictions,
col = DA$color, pch = 5)
legend("bottomright", inset = 0.01,
legend=c("D. octopetala", "Hybrid", "D. alaskensis", "1:1 line"),
text.font = c(3,1,3,1),
col=c("#F8766D", "black", "#00B0F6", "black"), pch = c(16,16,16,NA),
lty = c(NA,NA,NA,1), bg = 'white')
dev.new(width = 6, height = 6, unit = 'in')
par(mfrow = c(1,1))
plot(DA$DA, DA$Predictions, cex.lab = 1.5,
xlab = "Actual Dryas alaskensis ancestry",
ylab = "Predicted Dryas alaskensi ancestry")
lines(x = c(-2, 2), y = c(-2, 2))
arrows(DA$DA, DA$min, DA$DA, DA$max,length=0.05, angle=90, code=3)
points(DA$DA, DA$Predictions,
col = DA$color, pch = 5)
legend("bottomright", inset = 0.01,
legend=c("D. octopetala", "Hybrid", "D. alaskensis", "1:1 line"),
text.font = c(3,1,3,1),
col=c("#F8766D", "black", "#00B0F6", "black"), pch = c(16,16,16,NA),
lty = c(NA,NA,NA,1), bg = 'white')
par(mfrow = c(1,1))
plot(DA$DA, DA$Predictions, cex.lab = 1.5,
xlab = "Actual Dryas alaskensis ancestry",
ylab = "Predicted Dryas alaskensi ancestry")
lines(x = c(-2, 2), y = c(-2, 2))
arrows(DA$DA, DA$min, DA$DA, DA$max,length=0.05, angle=90, code=3)
points(DA$DA, DA$Predictions,
col = DA$color, pch = 8)
legend("bottomright", inset = 0.01,
legend=c("D. octopetala", "Hybrid", "D. alaskensis", "1:1 line"),
text.font = c(3,1,3,1),
col=c("#F8766D", "black", "#00B0F6", "black"), pch = c(16,16,16,NA),
lty = c(NA,NA,NA,1), bg = 'white')
par(mfrow = c(1,1))
plot(DA$DA, DA$Predictions, cex.lab = 1.5,
xlab = "Actual Dryas alaskensis ancestry",
ylab = "Predicted Dryas alaskensi ancestry", pch = 8)
lines(x = c(-2, 2), y = c(-2, 2))
arrows(DA$DA, DA$min, DA$DA, DA$max,length=0.05, angle=90, code=3)
points(DA$DA, DA$Predictions,
col = DA$color, pch = 8)
legend("bottomright", inset = 0.01,
legend=c("D. octopetala", "Hybrid", "D. alaskensis", "1:1 line"),
text.font = c(3,1,3,1),
col=c("#F8766D", "black", "#00B0F6", "black"), pch = c(16,16,16,NA),
lty = c(NA,NA,NA,1), bg = 'white')
med = aggregate(mean.predictions$Predictions, by = l, med)
DA$Predictions = med[,2]
dev.new(width = 6, height = 6, unit = 'in')
par(mfrow = c(1,1))
plot(DA$DA, DA$Predictions, cex.lab = 1.5,
xlab = "Actual Dryas alaskensis ancestry",
ylab = "Predicted Dryas alaskensi ancestry", pch = 8)
lines(x = c(-2, 2), y = c(-2, 2))
arrows(DA$DA, DA$min, DA$DA, DA$max,length=0.05, angle=90, code=3)
points(DA$DA, DA$Predictions,
col = DA$color, pch = 8)
legend("bottomright", inset = 0.01,
legend=c("D. octopetala", "Hybrid", "D. alaskensis", "1:1 line"),
text.font = c(3,1,3,1),
col=c("#F8766D", "black", "#00B0F6", "black"), pch = c(16,16,16,NA),
lty = c(NA,NA,NA,1), bg = 'white')
med = aggregate(mean.predictions$Predictions, by = l, median)
DA$Predictions = med[,2]
dev.new(width = 6, height = 6, unit = 'in')
par(mfrow = c(1,1))
plot(DA$DA, DA$Predictions, cex.lab = 1.5,
xlab = "Actual Dryas alaskensis ancestry",
ylab = "Predicted Dryas alaskensi ancestry", pch = 8)
lines(x = c(-2, 2), y = c(-2, 2))
arrows(DA$DA, DA$min, DA$DA, DA$max,length=0.05, angle=90, code=3)
points(DA$DA, DA$Predictions,
col = DA$color, pch = 8)
legend("bottomright", inset = 0.01,
legend=c("D. octopetala", "Hybrid", "D. alaskensis", "1:1 line"),
text.font = c(3,1,3,1),
col=c("#F8766D", "black", "#00B0F6", "black"), pch = c(16,16,16,NA),
lty = c(NA,NA,NA,1), bg = 'white')
dev.new(width = 6, height = 6, unit = 'in')
par(mfrow = c(1,1))
plot(DA$DA, DA$Predictions, cex.lab = 1.5,
xlab = "Actual Dryas alaskensis ancestry",
ylab = "Predicted Dryas alaskensi ancestry", pch = 8)
lines(x = c(-2, 2), y = c(-2, 2))
arrows(DA$DA, DA$min, DA$DA, DA$max,length=0.05, angle=90, code=3)
points(DA$DA, DA$Predictions,
col = DA$color, pch = 8)
legend("bottomright", inset = 0.01,
legend=c("D. octopetala", "Hybrid", "D. alaskensis", "1:1 line"),
text.font = c(3,1,3,1),
col=c("#F8766D", "black", "#00B0F6", "black"), pch = c(8,8,8,NA),
lty = c(NA,NA,NA,1), bg = 'white')
c.rmse = caret::RMSE(mean.predictions$Predictions, mean.predictions$DA)
c.r2 = caret::R2(mean.predictions$Predictions, mean.predictions$DA)
c.rmse
c.r2
a = caret::RMSE(full.mat_1, spectra.df$DA)
b = caret::RMSE(full.mat_2, spectra.df$DA)
c = caret::RMSE(full.mat_3, spectra.df$DA)
d = caret::RMSE(full.mat_4, spectra.df$DA)
e = caret::RMSE(full.mat_5, spectra.df$DA)
rmse = c(a,b,c,d,e)
f = caret::R2(full.mat_1, spectra.df$DA)
g = caret::R2(full.mat_2, spectra.df$DA)
h = caret::R2(full.mat_3, spectra.df$DA)
i = caret::R2(full.mat_4, spectra.df$DA)
j = caret::R2(full.mat_5, spectra.df$DA)
r2 = c(f,g,h,i,j)
dev.new(width = 6, height = 6, unit = 'in')
par(mfrow = c(1,1))
plot(DA$DA, DA$Predictions, cex.lab = 1.5,
xlab = "Actual Dryas alaskensis ancestry",
ylab = "Predicted Dryas alaskensi ancestry", pch = 8)
lines(x = c(-2, 2), y = c(-2, 2))
arrows(DA$DA, DA$min, DA$DA, DA$max,length=0.05, angle=90, code=3)
points(DA$DA, DA$Predictions,
col = DA$color, pch = 8)
c.rmse = caret::RMSE(mean.predictions$Predictions, mean.predictions$DA)
c.r2 = caret::R2(mean.predictions$Predictions, mean.predictions$DA)
c.rmse
c.r2
sd(rmse)
sd(r2)
#Caret PLSDA
################################################################################
#Set up
################################################################################
library(spectrolab)
library(caret)
library(mlbench)
library(corrplot)
library(matrixStats)
library(naniar)
library(rlist)
setwd("C:/Users/istas/OneDrive/Documents/Dryas Research/Dryas 2.0")
################################################################################
#Data setup !!!!NOTE: use ctrl+f to find a replace the field to be classified!!!
################################################################################
#data
spec_all = readRDS("Clean-up/Clean_spectra/clean_all.rds")
spec_all = spec_all[!meta(spec_all)$sp_loc == 'DX',]
spec_all = spec_all[!meta(spec_all)$sp_loc == "NaN",]
spec_all.m = as.matrix(spec_all)
spec_all.df = as.data.frame(spec_all)
#Resample by every 10 nm
spec_small = resample(spec_all, seq(400, 2400, by = 10))
spec_mat_s = as.matrix(spec_small)
spec_mat = spec_mat_s
#combine relavant meta data to matrix
spec_df = as.data.frame(spec_mat)
spec_df = cbind(spec_df, spec_all.df$sp_loc)
colnames(spec_df)[colnames(spec_df) == "spec_all.df$sp_loc"] <- "sp_loc"
#Set number of components to be used
ncomp = 38
inTrain <- caret::createDataPartition(
y = spec_df$sp_loc,
p = .7,
list = FALSE
)
training <- spec_df[inTrain,]
testing <- spec_df[-inTrain,]
ctrl <- trainControl(
method = "repeatedcv",
number = 10,
repeats = 3)
#Fit model. Note max iterations set to 10000 to allow model convergence
plsFit <- train(
sp_loc ~ .,
data = training,
maxit = 10000,
method = "pls",
trControl = ctrl,
tuneLength = ncomp)
plsFit$finalModel$residuals
spec_all = readRDS("Clean-up/Clean_spectra/clean_all.rds")
spec_all = spec_all[!meta(spec_all)$Species_ID == 'DX',]
spec_all = spec_all[!meta(spec_all)$Species_ID == "NaN",]
spec_all.m = as.matrix(spec_all)
spec_all.df = as.data.frame(spec_all)
#Resample by every 10 nm
spec_small = resample(spec_all, seq(400, 2400, by = 10))
spec_mat_s = as.matrix(spec_small)
spec_mat = spec_mat_s
#combine relavant meta data to matrix
spec_df = as.data.frame(spec_mat)
spec_df = cbind(spec_df, spec_all.df$Species_ID)
colnames(spec_df)[colnames(spec_df) == "spec_all.df$Species_ID"] <- "Species_ID"
spec_df = cbind(spec_df, spec_all.df$Location)
colnames(spec_df)[colnames(spec_df) == 'spec_all.df$Location'] <- 'Location'
spec_all = readRDS("Clean-up/Clean_spectra/clean_all.rds")
spec_all = spec_all[!meta(spec_all)$GenePop_ID == 'DX',]
spec_all = spec_all[!meta(spec_all)$GenePop_ID == "NaN",]
spec_all.m = as.matrix(spec_all)
spec_all.df = as.data.frame(spec_all)
#Resample by every 10 nm
spec_small = resample(spec_all, seq(400, 2400, by = 10))
spec_mat_s = as.matrix(spec_small)
spec_mat = spec_mat_s
#combine relavant meta data to matrix
spec_df = as.data.frame(spec_mat)
spec_df = cbind(spec_df, spec_all.df$GenePop_ID)
colnames(spec_df)[colnames(spec_df) == "spec_all.df$GenePop_ID"] <- "GenePop_ID"
spec_df = cbind(spec_df, spec_all.df$Location)
colnames(spec_df)[colnames(spec_df) == 'spec_all.df$Location'] <- 'Location'
#Set number of components to be used
ncomp = 38
inTrain <- caret::createDataPartition(
y = spec_df$GenePop_ID,
p = .7,
list = FALSE
)
training <- spec_df[inTrain,]
testing <- spec_df[-inTrain,]
ctrl <- trainControl(
method = "repeatedcv",
number = 10,
repeats = 3)
#Fit model. Note max iterations set to 10000 to allow model convergence
plsFit <- train(
GenePop_ID ~ .-Location,
data = training,
maxit = 10000,
method = "pls",
trControl = ctrl,
tuneLength = ncomp)
